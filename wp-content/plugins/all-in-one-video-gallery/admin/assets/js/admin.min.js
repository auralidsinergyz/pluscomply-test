!function(e){"use strict";function i(e){var i=document.body.appendChild(document.createElement("input"));i.value=e,i.focus(),i.select(),document.execCommand("copy"),i.parentNode.removeChild(i)}function a(i,a){if(t){t.open();return}t=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",multiple:!1});var t,o,s=function(t){switch(a){case"tracks":e("#"+i.closest("tr").find(".aiovg-track-src").attr("id")).val(t.url);break;case"categories":e("#aiovg-categories-image_id").val(t.id),e("#aiovg-categories-image").val(t.url),e("#aiovg-categories-image-wrapper").html('<img src="'+t.url+'" />'),e("#aiovg-categories-upload-image").hide(),e("#aiovg-categories-remove-image").show();break;case"settings":i.prev(".aiovg-url").val(t.url);break;default:i.closest(".aiovg-media-uploader").find("input[type=text]").val(t.url).trigger("file.uploaded")}};t.on("insert",function(){o=t.state().get("selection").first().toJSON(),!(0>e.trim(o.url.length))&&s(o)}),t.state("embed").on("select",function(){var i=t.state().props.toJSON();!(0>e.trim(i.url.length))&&(i.id=0,s(i))}),t.on("open",function(){e("#menu-item-gallery, #menu-item-playlist, #menu-item-video-playlist").hide()}),t.open()}function t(i){e.fn.wpColorPicker&&i.find(".aiovg-color-picker-field").wpColorPicker({change:_.throttle(function(){e(this).trigger("change")},3e3)})}function o(i){e.fn.autocomplete&&(i.find(".aiovg-autocomplete-input").autocomplete({source:function(i,a){e.ajax({url:ajaxurl,dataType:"json",method:"post",data:{action:"aiovg_autocomplete_get_videos",security:aiovg_admin.ajax_nonce,term:i.term},success:function(i){a(e.map(i,function(e){return{label:e.post_title,value:e.post_title,data:e}}))}})},autoFocus:!0,minLength:0,select:function(i,a){var t=e(this).closest(".aiovg-widget-field");t.find(".aiovg-widget-input-id").val(a.item.data.ID).trigger("change"),0!=a.item.data.ID?t.find(".aiovg-autocomplete-result").html('<span class="dashicons dashicons-yes-alt"></span> <span>'+a.item.data.post_title+'</span> <a href="javascript:void(0);" class="aiovg-remove-autocomplete-result">'+aiovg_admin.i18n.remove+"</a>"):t.find(".aiovg-autocomplete-result").html('<span class="dashicons dashicons-info"></span> <span>'+aiovg_admin.i18n.no_video_selected+"</span>")},open:function(){e(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){e(this).removeClass("ui-corner-top").addClass("ui-corner-all"),e(this).val("")}}),e(document).on("click",".aiovg-remove-autocomplete-result",function(){var i=e(this).closest(".aiovg-widget-field");i.find(".aiovg-widget-input-id").val(0).trigger("change"),i.find(".aiovg-autocomplete-result").html('<span class="dashicons dashicons-info"></span> <span>'+aiovg_admin.i18n.no_video_selected+"</span>")}))}function s(e,i){t(i),o(i)}e(function(){e(document).on("click",".aiovg-upload-media",function(i){i.preventDefault(),a(e(this),"default")}),e.fn.wpColorPicker&&e(".aiovg-color-picker").wpColorPicker(),e(".aiovg-modal-button").magnificPopup({type:"inline"}),e("input[type=radio]","#aiovg-shortcode-selector").on("change",function(i){var a=e("input[type=radio]:checked","#aiovg-shortcode-selector").val();e(".aiovg-shortcode-form").hide(),e(".aiovg-shortcode-instructions").hide(),e("#aiovg-shortcode-form-"+a).show(),e("#aiovg-shortcode-instructions-"+a).show()}).trigger("change"),e(document).on("click",".aiovg-shortcode-section-header",function(i){var a=e(this).parent();a.hasClass("aiovg-active")||e(this).closest(".aiovg-shortcode-form").find(".aiovg-shortcode-section.aiovg-active").toggleClass("aiovg-active").find(".aiovg-shortcode-controls").slideToggle(),a.toggleClass("aiovg-active").find(".aiovg-shortcode-controls").slideToggle()}),e("select[name=type]","#aiovg-shortcode-form-video").on("change",function(){var i=e(this).val();e("#aiovg-shortcode-form-video").removeClass(function(e,i){var a=i.match(/\aiovg-type-\S+/ig);return a?a.join(" "):""}).addClass("aiovg-type-"+i)}),e("select[name=template]","#aiovg-shortcode-form-videos").on("change",function(){var i=e(this).val();e("#aiovg-shortcode-form-videos").removeClass(function(e,i){var a=i.match(/\aiovg-template-\S+/ig);return a?a.join(" "):""}).addClass("aiovg-template-"+i)}).trigger("change"),e("select[name=template]","#aiovg-shortcode-form-categories").on("change",function(){var i=e(this).val();e("#aiovg-shortcode-form-categories").removeClass(function(e,i){var a=i.match(/\aiovg-template-\S+/ig);return a?a.join(" "):""}).addClass("aiovg-template-"+i)}).trigger("change"),e("#aiovg-generate-shortcode").on("click",function(i){i.preventDefault();var a=e("input[type=radio]:checked","#aiovg-shortcode-selector").val(),t={};e(".aiovg-shortcode-field","#aiovg-shortcode-form-"+a).each(function(){var i=e(this),a=i.attr("type"),o=i.attr("name"),s=i.val(),n=0;void 0!==i.data("default")&&(n=i.data("default")),"checkbox"==a?s=i.is(":checked")?1:0:("category"==o||"tag"==o)&&(s=e("input[type=checkbox]:checked",i).map(function(){return this.value}).get().join(",")),s!=n&&(t[o]=s)});var o=a;for(var s in t)t.hasOwnProperty(s)&&(o+=" "+s+'="'+t[s]+'"');e("#aiovg-shortcode").val("[aiovg_"+o+"]")}),e("#aiovg-issues-check-all").on("change",function(i){(e(this).is(":checked")?1:0)?e(".aiovg-issue","#aiovg-issues").prop("checked",!0):e(".aiovg-issue","#aiovg-issues").prop("checked",!1)}),e("#aiovg-issues-form").submit(function(){var i=0;if(e(".aiovg-issue:checked","#aiovg-issues").each(function(){i=1}),!i)return alert(aiovg_admin.i18n.no_issues_selected),!1}),e(".aiovg-copy-url").on("click",function(){var a=e(this).data("url");i(a),alert(aiovg_admin.i18n.copied+"\n"+a)}),e(".aiovg-copy-shortcode").on("click",function(){var a='[aiovg_video id="'+parseInt(e(this).data("id"))+'"]';i(a),alert(aiovg_admin.i18n.copied+"\n"+a)}),e("#aiovg-video-type").on("change",function(i){i.preventDefault();var a=e(this).val();e(".aiovg-toggle-fields").hide(),e(".aiovg-type-"+a).show(300)}).trigger("change"),e("#aiovg-add-new-source").on("click",function(i){i.preventDefault();var a=e(this).data("limit"),t=e(".aiovg-quality-selector","#aiovg-field-mp4").length,o=t-1;0==o&&e(".aiovg-quality-selector","#aiovg-field-mp4").show();var s=e("#aiovg-source-clone").find(".aiovg-media-uploader").clone();s.find("input[type=radio]").attr("name","quality_levels["+o+"]"),s.find("input[type=text]").attr("name","sources["+o+"]"),e(this).before(s),t+1>=a&&e(this).hide()}),e("#aiovg-field-mp4").on("change",".aiovg-quality-selector input[type=radio]",function(){var i=e(this),a=[];e(".aiovg-quality-selector").each(function(){var t=e(this).find("input[type=radio]:checked").val();t&&(a.includes(t)?(i.prop("checked",!1),alert(aiovg_admin.i18n.quality_exists)):a.push(t))})}),e("#aiovg-add-new-track").on("click",function(i){i.preventDefault();var a=e(".aiovg-tracks-row","#aiovg-tracks").length,t=e("#aiovg-tracks-clone").find("tr").clone();t.find(".aiovg-track-src").attr("id","aiovg-track-"+a),e("#aiovg-tracks").append(t)}),e(".aiovg-tracks-row","#aiovg-tracks").length||e("#aiovg-add-new-track").trigger("click"),e("body").on("click",".aiovg-upload-track",function(i){i.preventDefault(),a(e(this),"tracks")}),e("body").on("click",".aiovg-delete-track",function(i){i.preventDefault(),e(this).closest("tr").remove()}),function i(){if(e.fn.sortable){var a=e("#aiovg-tracks tbody");a.hasClass("ui-sortable")&&a.sortable("destroy"),a.sortable({handle:".aiovg-handle"})}}(),e("#aiovg-categories-upload-image").on("click",function(i){i.preventDefault(),a(e(this),"categories")}),e("#aiovg-categories-remove-image").on("click",function(i){i.preventDefault(),e("#aiovg-categories-image_id").val(""),e("#aiovg-categories-image").val(""),e("#aiovg-categories-image-wrapper").html(""),e("#aiovg-categories-remove-image").hide(),e("#aiovg-categories-upload-image").show()}),e(document).ajaxComplete(function(i,a,t){if(e("#aiovg-categories-image").length&&t.data){var o=t.data.split("&");-1!==e.inArray("action=add-tag",o)&&""!=e(a.responseXML).find("term_id").text()&&(e("#aiovg-categories-image_id").val(""),e("#aiovg-categories-image").val(""),e("#aiovg-categories-image-wrapper").html(""),e("#aiovg-categories-exclude_search_form").prop("checked",!1),e("#aiovg-categories-exclude_video_form").prop("checked",!1),e("#aiovg-categories-remove-image").hide(),e("#aiovg-categories-upload-image").show())}}),e(".form-table","#aiovg-settings").each(function(){var i=e(this).find("tr:first th label").attr("for").split("[");i=i[0].replace(/_/g,"-"),e(this).attr("id",i)}),e(".aiovg-browse","#aiovg-settings").on("click",function(i){i.preventDefault(),a(e(this),"settings")}),e("tr.template","#aiovg-categories-settings").find("select").on("change",function(){var i=e(this).val();e("#aiovg-categories-settings").removeClass(function(e,i){var a=i.match(/\aiovg-template-\S+/ig);return a?a.join(" "):""}).addClass("aiovg-template-"+i)}).trigger("change"),e("tr.template","#aiovg-videos-settings").find("select").on("change",function(){var i=e(this).val();e("#aiovg-videos-settings").removeClass(function(e,i){var a=i.match(/\aiovg-template-\S+/ig);return a?a.join(" "):""}).addClass("aiovg-template-"+i)}).trigger("change"),e(document).on("change",".aiovg-widget-form-categories .aiovg-widget-input-template",function(){var i=e(this).val();e(this).closest(".aiovg-widget-form-categories").removeClass(function(e,i){var a=i.match(/\aiovg-template-\S+/ig);return a?a.join(" "):""}).addClass("aiovg-template-"+i)}),e(document).on("change",".aiovg-widget-form-videos .aiovg-widget-input-template",function(){var i=e(this).val();e(this).closest(".aiovg-widget-form-videos").removeClass(function(e,i){var a=i.match(/\aiovg-template-\S+/ig);return a?a.join(" "):""}).addClass("aiovg-template-"+i)}),e("#widgets-right .widget:has(.aiovg-color-picker-field)").each(function(){t(e(this))}),e("#widgets-right .widget:has(.aiovg-autocomplete-input)").each(function(){o(e(this))}),e(document).on("widget-added widget-updated",s)})}(jQuery);
