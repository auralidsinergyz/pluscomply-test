/*! @name @brightcove/videojs-quality-menu @version 2.0.1 @license UNLICENSED */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsQualityMenu=t(e.videojs)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=t(e);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;
/*! @name videojs-contrib-quality-levels @version 3.0.0 @license Apache-2.0 */
!function(e,t){e.exports=function(e){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=t(e);class s{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get:()=>t.enabled_(),set(e){t.enabled_(e)}}),t}}class i extends l.default.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get:()=>e.selectedIndex_}),Object.defineProperty(e,"length",{get:()=>e.levels_.length}),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const l=this.levels_.length;return t=new s(e),""+l in this||Object.defineProperty(this,l,{get(){return this.levels_[l]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let l=0,s=this.length;l<s;l++)if(this[l]===e){t=this.levels_.splice(l,1)[0],this.selectedIndex_===l?this.selectedIndex_=-1:this.selectedIndex_>l&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,l=this.length;t<l;t++){const l=this[t];if(l.id===e)return l}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}i.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const e in i.prototype.allowedEvents_)i.prototype["on"+e]=null;var n="3.0.0";const a=l.default.registerPlugin||l.default.plugin,u=function(e,t){const l=e.qualityLevels,s=new i,a=function(){s.dispose(),e.qualityLevels=l,e.off("dispose",a)};return e.on("dispose",a),e.qualityLevels=()=>s,e.qualityLevels.VERSION=n,s},o=function(e){return u(this,l.default.mergeOptions({},e))};return a("qualityLevels",o),o.VERSION=n,o}(l.default)}({exports:{}});const s=l.default.getComponent("MenuItem"),i=l.default.dom||l.default;class n extends s{constructor(e,t={}){const l=t.selected;t.selected=t.active,super(e,t);const s=e.qualityLevels();this.levels_=t.levels,this.selected_=l,this.handleQualityChange=this.handleQualityChange.bind(this),this.controlText(t.controlText),this.on(s,"change",this.handleQualityChange),this.on("dispose",(()=>{this.off(s,"change",this.handleQualityChange)}))}createEl(e,t,l){const s=super.createEl(e,t,l),n=i.createEl("span",{className:"vjs-quality-menu-item-sub-label",innerHTML:this.localize(this.options_.subLabel||"")});return this.subLabel_=n,s&&s.appendChild(n),s}handleClick(){this.updateSiblings_();const e=this.player().qualityLevels(),t=e.selectedIndex;for(let l=0,s=e.length;l<s;l++)l!==t&&(e[l].enabled=!1);for(let t=0,l=this.levels_.length;t<l;t++)e[this.levels_[t]].enabled=!0;-1!==t&&-1===this.levels_.indexOf(t)&&(e[t].enabled=!1)}handleQualityChange(){const e=this.player().qualityLevels(),t=this.levels_.indexOf(e.selectedIndex)>-1;this.selected(t)}selected(e){if(this.selectable)if(this.selected_){this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(this.localize("{1}, selected",this.localize(this.options_.controlText)));const t=this.player().controlBar.getChild("QualityMenuButton");e?t.removeClass("vjs-quality-menu-button-waiting"):t.addClass("vjs-quality-menu-button-waiting")}else this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(this.options_.controlText)}updateSiblings_(){const e=this.player().qualityLevels(),t=this.player().controlBar.getChild("QualityMenuButton").items;for(let l=0,s=t.length;l<s;l++){const s=t[l],i=s.levels_.indexOf(e.selectedIndex)>-1;s.selected_=s===this,s.selected(i)}}}const a=l.default.getComponent("MenuButton"),u=function(e){for(let t=0,l=e.length;t<l;t++)if(!e[t].height)return!1;return!0},o=function(e){return e>=2160?"4K":e>=720?"HD":""};l.default.registerComponent("QualityMenuButton",class extends a{constructor(e,t={}){super(e,t),this.el_.setAttribute("aria-label",this.localize("Quality Levels")),this.controlText("Quality Levels"),this.qualityLevels_=e.qualityLevels(),this.update=this.update.bind(this),this.handleQualityChange_=this.handleQualityChange_.bind(this),this.changeHandler_=()=>{const e=this.options_.defaultResolution;for(let t=0;t<this.items.length;t++)-1!==this.items[t].options_.label.indexOf(e)&&this.items[t].handleClick()},this.on(this.qualityLevels_,"addqualitylevel",this.update),this.on(this.qualityLevels_,"removequalitylevel",this.update),this.on(this.qualityLevels_,"change",this.handleQualityChange_),this.one(this.qualityLevels_,"change",this.changeHandler_),this.update(),this.on("dispose",(()=>{this.off(this.qualityLevels_,"addqualitylevel",this.update),this.off(this.qualityLevels_,"removequalitylevel",this.update),this.off(this.qualityLevels_,"change",this.handleQualityChange_),this.off(this.qualityLevels_,"change",this.changeHandler_)}))}buildWrapperCSSClass(){return`vjs-quality-menu-wrapper ${super.buildWrapperCSSClass()}`}buildCSSClass(){return`vjs-quality-menu-button ${super.buildCSSClass()}`}createItems(){const e=[];if(!this.qualityLevels_||!this.qualityLevels_.length)return e;let t;if(this.options_.useResolutionLabels&&u(this.qualityLevels_)?(t=this.groupByResolution_(),this.addClass("vjs-quality-menu-button-use-resolution")):(t=this.groupByBitrate_(),this.removeClass("vjs-quality-menu-button-use-resolution")),t.length<=1)return[];t.forEach((t=>{t.levels.length&&(t.selectable=!0,e.push(new n(this.player(),t)))}));const l=new n(this.player(),{levels:Array.prototype.map.call(this.qualityLevels_,((e,t)=>t)),label:"Auto",controlText:"Auto",active:!0,selected:!0,selectable:!0});return this.autoMenuItem_=l,e.push(l),e}groupByResolution_(){const e={},t=[];for(let l=0,s=this.qualityLevels_.length;l<s;l++){const s=this.qualityLevels_[l],i=this.qualityLevels_.selectedIndex===l,n=s.height;let a;if(this.options_.resolutionLabelBitrates){a=`${n}p @ ${Math.round(s.bitrate/1e3)} kbps`}else a=n+"p";if(!e[a]){const l=o(n);e[a]={levels:[],label:a,controlText:a,subLabel:l},t.push({label:a,lines:n})}i&&(e[a].active=!0),e[a].levels.push(l)}t.sort(((e,t)=>t.lines-e.lines));const l=[];return t.forEach((t=>{l.push(e[t.label])})),l}groupByBitrate_(){const e=[{levels:[],label:"HD",controlText:"High Definition"},{levels:[],label:"SD",controlText:"Standard Definition"}];for(let t=0,l=this.qualityLevels_.length;t<l;t++){const l=this.qualityLevels_[t],s=this.qualityLevels_.selectedIndex===t;let i;i=l.bitrate<this.options_.sdBitrateLimit?e[1]:e[0],s&&(i.active=!0),i.levels.push(t)}return e[0].levels.length&&e[1].levels.length?e:[]}handleQualityChange_(){const e=this.qualityLevels_[this.qualityLevels_.selectedIndex],t=this.options_.useResolutionLabels&&u(this.qualityLevels_);let l="";e&&(t?l=o(e.height):e.bitrate>=this.options_.sdBitrateLimit&&(l="HD")),"HD"===l?(this.addClass("vjs-quality-menu-button-HD-flag"),this.removeClass("vjs-quality-menu-button-4K-flag")):"4K"===l?(this.removeClass("vjs-quality-menu-button-HD-flag"),this.addClass("vjs-quality-menu-button-4K-flag")):(this.removeClass("vjs-quality-menu-button-HD-flag"),this.removeClass("vjs-quality-menu-button-4K-flag")),this.autoMenuItem_&&(this.autoMenuItem_.manuallySelected_&&e?this.autoMenuItem_.subLabel_.innerHTML=this.localize(l):this.autoMenuItem_.subLabel_.innerHTML="")}});var h="2.0.1";const r=l.default.registerPlugin||l.default.plugin,d={sdBitrateLimit:2e6,useResolutionLabels:!0,resolutionLabelBitrates:!1,defaultResolution:"none"},c=(e,t)=>{e.addClass("vjs-quality-menu");const l=e.getChild("controlBar"),s=l.addChild("QualityMenuButton",t,l.children_.length-2);return function(){e.removeClass("vjs-quality-menu"),l.removeChild(s),s.dispose()}},v=function(e){!function(e,t){if(void 0!==e.qualityLevels){e.qualityLevels();let l=()=>{};e.ready((()=>{l=c(e,t),e.on("loadstart",(()=>{l(),l=c(e,t)}))})),e.qualityMenu=()=>{},e.qualityMenu.VERSION=h}}(this,l.default.mergeOptions(d,e))};return r("qualityMenu",v),v.VERSION=h,v}));
